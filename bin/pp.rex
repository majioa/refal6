START "pp.rex"
*PUTOUT=F7(G O k *PRINTLN! hDF lB p)
*PROUT=F8(O k *PRINTLN! i *STDOUT gE lB p)
*CARD=F13(O k *PRINT! i *STDOUT gE lB k *READ_LINE! i *STDIN lB p)
*GET=F23(G P k *EOF dD lA oA u 9 C F P k *READ_LINE! dD lB p C T P i 0 p)
*GO=F15(P k *Doall k *Skey i () k *Args i 1 lB lB lB p)
*Args=F25(G P k *ARG dD lA oA u 3 P p O a eJ b k *Args k *ADD dD i 1 lB lB p)
*Plst=F18(u 3 P p A O SDB O k *PROUT TD gG lB k *Plst gI lB p)
*Skey=F46(A O SDB u 35 A u 22 C '/' O SHB O k *Skey a a k *UPPER TH gL lB b TD gG b gN lB p O SHB O dH k *Skey dD gM lB p P k S TD gG b p)
*Doall=F70(u 20 K P k *Plst jL ("             ***   PAGE PRINTING   ***") ("Syntax: PP <file> [/q[s]] [/b<num>] [/e<num>] [/p<num>] [/s<num>] [/m<num>]") ("    /q[s] - stop after each page [/qs - do not skip the paper]") ("    /c - print contents (each line after empty line)") ("    /bN, /eM - print from N-th to M-th pages") ("    /pN - print N lines per page, optionally 66") ("    /lN - print N symbols per line, optionally 80") ("    /sN - size of page is N, optionally 72") ("    /mM - break the page on empty line after which") ("          there are no more then M, optionally 6, nonempty lines") ("    /oN - offset from left is N, optionally 0") ("    /1, /2 - print only odd or only even pages") lB p L O k *Opt jB 'F' ('prn') dD lA oA O k *OPEN_FILE i 4 eL i W lA oB u 20 C F P k *PROUT jJ 'Can\'t open' eL lB p C T P k *Do hED lB p)
*Do=F21(A O SDB u 15 B O SII O k *Job dD dH lB k *Do hJH lB p P p)
*Job=F60(A O SDB K P k *OPEN_FILE i 3 eG i R lA oA u 22 C F P k *PROUT jK 'Can\'t open ' TD gG lB p C T P k *Prtxt a hDH b k *Pagnum i 1 k *Pags dH k *Inputf dH lB lB lB lB p)
*Prtxt=F31(A A O SFE K P SDB O k *Outpags dD k *SelByParity dJ k *Mkcontns dJ gL lB lB k *SelByParity dJ k *Selpag dJ eL lB lB lB p)
*Inputf=F25(K P k *GET i 3 lA oA u 5 C 0 P p O k *Cut dD eJ lB k *Inputf dD lB p)
*Mkcontns=F39(K O k *Arg i 'C' dD lA oA u 5 C F P p K P k *Pagnum i i k *Pags dD k *LINE i CONTENTS lB k *LINE lB k *Contns gF lB lB lB p)
*Contns=F51(u 48 G A C P u 17 C EMPTY-LINE O SEB O k *Contns1 dD a dG TE gJ b gL lB p u 16 K O SEB O k *Contns dD a dG TE gJ b gL lB p P SEB O k *Contns gI lB p P p)
*Contns1=F59(u 56 G A C P u 9 P SEB O k *Contns1 gI lB p u 17 C EMPTY-LINE O SEB O k *Contns1 dD a dG TE gJ b gL lB p K O SEB O k *Mkline dD k *GETV dH lB lB k *Contns dD a dG TE gJ b gL lB p P p)
*Mkline=F12(G O k *LINE dD jC '   ' gF lB p)
*Pags=F99(K O k *Line-per-page dD lA oA K P k *FIRST dK eF lA oB A u 20 SPN O SQQ U W C FORM-FEED O k P eU b k *Pags dD eX eS lB p O SPN u 7 P k P eS b p u 14 C EMPTY-LINE O k *Skipemp dD k P eS b eV lB p O k *LAST k *Maxbot dD lA eS lA oC A O SZX O k *Fend e_ i () lA oD B O See O k *Skipemp dD k P "e]" eg b ei eU lB p)
*Skipemp=F25(K A C P O SEB u 10 C EMPTY-LINE O k *Skipemp gE gL lB p O dE k *Pags dD gK lB p)
*Fend=F35(u 25 B u 8 D EMPTY-LINE O SEE O hGD p L O SEE O k *Fend gH a dF TD gJ b lB p A O SDB P TD gG i () p)
*Pagnum=F17(G u 3 P p K O gE k *Pagnum k *Nextnum dD lB gG lB p)
*Nextnum=F33(G P k *TYPE dD lA oA u 11 C 'N' O k *ADD dD i 1 lB p C 'F' O k *SETV dD k *GETV dD lB i 'i' lB p)
*SelByParity=F19(K O k *SelPar k *Arg i '1' dD lB k *Arg i '2' dD lB gF lB p)
*SelPar=F50(u 7 EB F F O gG p K K u 15 G K P k *SelPar hDG k *Nextnum dF lB i (P) lB p u 3 P p G K G K O k *SelP dD gG lB k *SelP hEI lB k *SelPar eE gK lB p)
*SelP=F14(u 7 C F G K P p K G K P gF p)
*Selpag=F48(K u 3 P p G K O k *Pbegin dD lA oA K P k *Pend dD lA oB K P k *Sorted dM dE dR lA oC u 10 C T P gF k *Selpag hDH lB p G P k *Selpag dD gH lB p)
*Outpags=F51(K u 3 P p G A C P O SFB O SCE A A O SON K P SME P k *Pause dD lB k *Ppage i 0 dD k *Offset dS lB i PaperOutOn k *Title gE lB i PaperOutOff TF gJ lB k *Outpags dD gL lB p)
*Title=F50(A A O SFE K P SDB G P k *LINE k *Sfile TD TF gI lB jC '   ' k *Stime lB jO '               ' k *Spage eI dK lB lB jB EMPTY-LINE EMPTY-LINE p)
*Ppage=F86(G K G u 7 P k *Skip-foot gE lB p u 15 C PaperOutOff O k *PaperOut i Off lB k *Ppage hDF gI lB p u 15 C PaperOutOn O k *PaperOut i On lB k *Ppage hDF gI lB p u 20 C EMPTY-LINE O k *Plino dF lB k *Ppage k *ADD dD i 1 lB gF gI lB p K O k *Plino dF k *GETV dG lB lB k *Ppage k *ADD dD i 1 lB gF gI lB p)
*Plino=F13(G O k *Plin k *Multe dD i ' ' lB gF lB p)
*Plin=F8(O k *PUTOUT i 4 gE lB p)
*Line-per-page=F10(K P k *Numarg jB 'P' 66 dD lB p)
*Syms-per-line=F10(K P k *Numarg jB 'L' 80 dD lB p)
*Page-size=F10(K P k *Numarg jB 'S' 72 dD lB p)
*Pbegin=F10(K P k *Numarg jB 'B' 1 dD lB p)
*Pend=F10(K P k *Numarg jB 'E' 9999 dD lB p)
*Maxbot=F10(K P k *Numarg jB 'M' 6 dD lB p)
*Offset=F10(K P k *Numarg jB 'O' 0 dD lB p)
*Title-size=F5(K P i 3 p)
*Sfile=F11(O k *Merge k *UPPER gE lB i ('                    ') lB p)
*Spage=F13(H O k *UPPER gF lB i '-' k *TO_CHARS dD lB p)
*Stime=F5(P k *TIME lB p)
*Pause=F109(K P k *Arg i 'Q' dD lA oA u 5 C F P p K P k *PROUT "j~" 'Press [d] ENTER to skip d lines and print, Ctrl+C to unterrupt' lA k *CARD lA oB O k *TYPE eO lA oC u 13 C 'D' G P k *Skip k *NUMB dU lB lB p O p)
*PaperOut=F27(w 15 u 7 C On P i '9' x C Off P i '8' x oA G P k *PRINT! jB 4 '' dH lB p)
*Skip-foot=F33(G K P k *Arg i 'Q' dE lA oA u 8 A C 'S' P SJH P p K P k *Skip k *SUB k *Page-size dE lB dD lB lB p)
*Skip=F21(u 5 C 0 P p G P k *Plin lB k *Skip k *SUB dD i 1 lB lB p)
*Merge=F25(u 17 G B O SFF G O dD k *Merge gH a TE gK b lB p B O SEE O TD gI p)
*Arg=F39(G A u 26 C S u 16 SEB P SGF V X ID O SJF O a TE TJ gN b p O SEB P i F p L O SEB P k *Arg dD dG lB p)
*Opt=F26(G A O SEB K P k *Arg dD dI lA oA u 7 C F P TE gH p A O SNL P eQ p)
*Numarg=F26(G G K P k *Arg dD dF lA oA u 6 C F P dE p A O SKI P k *NUMB eN lB p)
*Sorted=F29(G u 5 P i T p G O k *COMPARE eE lA oA u 7 C '>' P i F p G P k *Sorted hEG lB p)
*Cut=F57(K O SDB u 10 D ' ' O k *Cut dD gI lB p O k *FIRST k *Syms-per-line dD lA eH lA oA A O SMK u 7 P k *LINE eP lB p O k *LINE eP lB k *Cut dD jJ '          ' eR lB p)
*Multe=F37(u 5 C 0 O p u 6 C 1 O gF p G O k *DIVMOD dD i 2 lA oA G G P k *Multe dK gF eF lB k *Multe dL eF lB p)
*LINE=F25(u 5 P i EMPTY-LINE p u 7 C '' P i FORM-FEED p O k *SETV k *MAKE i STRING lB gE lB p)
<*SHIFT *SYSARG 1 -1>
<*GO>
